import { mergeResults, Partitions } from '../partitions'

import { getArgs } from '../cli'
import { notify } from '../notifications'
import { S } from '../templates'

function main() {
	const { hw, runOpts } = getArgs()
	const results: S[] = mergeResults(hw, runOpts)
	const partitioned:any = {}
    // ­Ъўб­Ъўб­Ъўб­Ъўб рЃћрЃА рЃЏрЃЌрЃџрЃўрЃљрЃюрЃў рЃърЃарЃЮрЃфрЃћрЃАрЃў
    // рЃарЃљрЃЏ рЃЏрЃЮрЃЏрЃљрЃцрЃўрЃЦрЃарЃћрЃЉрЃўрЃюрЃљ partitions, рЃДрЃЮрЃцрЃўрЃџрЃўрЃДрЃЮ submission-рЃўрЃА 
    // рЃЋрЃћрЃџрЃў рЃЌрЃљрЃЋрЃўрЃЊрЃљрЃюрЃЋрЃћ
    results.forEach(r => {
    	if (r.status) {
    		if (partitioned[r.status]) {
    			partitioned[r.status].push(r)
    		} else {
    			partitioned[r.status] = [r]
    		}
    	}
    })

    notify(
    	partitioned,
    	categoriesToNotify,
    	subject,
    	hw,
    	runOpts,
    	{}
    	)
}

function subject(hwName: string) {
	return `рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў! ${hwName} рЃљрЃа рЃљрЃарЃўрЃА рЃЕрЃљрЃЉрЃљрЃарЃћрЃЉрЃБрЃџрЃў`
}

const categoriesToNotify: Partitions<boolean> | any = {
        crashed: false,
        notSubmitted: true,
        late: false,
        invalid: true,
        error: false,
        failed: false,
        passed: false,
        none: false
}



const templates = {
	invalid: (s: S) => `		
		<p>рЃћрЃА рЃљрЃарЃўрЃА рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃњрЃљрЃЏрЃЮрЃњрЃќрЃљрЃЋрЃюрЃўрЃџрЃў рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃљ рЃўрЃЏрЃўрЃА рЃерЃћрЃАрЃљрЃ«рЃАрЃћрЃюрЃћрЃЉрЃџрЃљрЃЊ, рЃарЃЮрЃЏ рЃърЃарЃЮрЃћрЃЦрЃбрЃўрЃАрЃЌрЃЋрЃўрЃА
		 рЃЉрЃЮрЃџрЃЮрЃА рЃљрЃбрЃЋрЃўрЃарЃЌрЃБрЃџрЃў рЃцрЃљрЃўрЃџрЃћрЃЉрЃў рЃљрЃарЃљрЃАрЃгрЃЮрЃа рЃцрЃЮрЃарЃЏрЃљрЃбрЃерЃўрЃљ, рЃарЃўрЃА рЃњрЃљрЃЏрЃЮрЃф рЃљрЃа рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃБрЃџрЃљ рЃЊрЃљ 
		 рЃљрЃа рЃўрЃЌрЃЋрЃџрЃћрЃЉрЃљ рЃЕрЃљрЃЉрЃљрЃарЃћрЃЉрЃБрЃџрЃљрЃЊ. рЃЌрЃБ рЃЊрЃћрЃЊрЃџрЃљрЃўрЃюрЃљрЃЏрЃЊрЃћ рЃАрЃгрЃЮрЃа рЃцрЃЮрЃарЃЏрЃљрЃбрЃерЃў рЃљрЃа рЃљрЃбрЃЋрЃўрЃарЃЌрЃљрЃЋ, 
		 рЃерЃћрЃюрЃў рЃерЃћрЃцрЃљрЃАрЃћрЃЉрЃљ рЃўрЃЦрЃюрЃћрЃЉрЃљ 0 рЃЦрЃБрЃџрЃљ.</p>

		<p>рЃДрЃЮрЃЋрЃћрЃџрЃў рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃўрЃАрЃЌрЃЋрЃўрЃА рЃЦрЃЋрЃћрЃЏрЃЮрЃЌ рЃЕрЃљрЃЋрЃАрЃЋрЃљрЃЏ рЃЉрЃЮрЃџрЃЮ рЃерЃћрЃЊрЃћрЃњрЃА</p>
		
		${s.results.map(r => `
                    <p><strong>${r.details}</strong></p>
                `).join('\n')}
	`,
	notSubmitted: (s: S) => `
		<p>рЃЊрЃћрЃЊрЃџрЃљрЃўрЃюрЃљрЃЏрЃЊрЃћ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃћрЃарЃЌрЃў рЃЊрЃдрЃћрЃљ рЃЊрЃљрЃарЃЕрЃћрЃюрЃўрЃџрЃў рЃЊрЃљ рЃърЃарЃЮрЃћрЃЦрЃбрЃў рЃ»рЃћрЃа рЃЎрЃўрЃЊрЃћрЃЋ рЃљрЃа рЃњрЃљрЃЦрЃЋрЃА рЃњрЃљрЃЏрЃЮрЃњрЃќрЃљрЃЋрЃюрЃўрЃџрЃў. рЃЊрЃдрЃћрЃўрЃЊрЃљрЃю рЃцрЃљрЃўрЃџрЃћрЃЉрЃўрЃА 
		рЃЋрЃљрЃџрЃўрЃЊрЃБрЃарЃЮрЃЉрЃљрЃА рЃўрЃАрЃћрЃЋ рЃАрЃћрЃарЃЋрЃћрЃарЃў рЃерЃћрЃљрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃА. рЃЏрЃћ рЃАрЃљрЃЏрЃерЃљрЃЉрЃљрЃЌрЃљрЃЏрЃЊрЃћ рЃ«рЃљрЃќрЃќрЃћ рЃљрЃа рЃЋрЃљрЃа рЃЊрЃљ рЃЋрЃћрЃдрЃљрЃа рЃерЃћрЃЋрЃФрЃџрЃћрЃЉ рЃЊрЃљрЃ«рЃЏрЃљрЃарЃћрЃЉрЃљрЃА.</p>

		<p>рЃерЃћрЃњрЃљрЃ«рЃАрЃћрЃюрЃћрЃЉ, рЃарЃЮрЃЏ рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃарЃў рЃерЃћрЃфрЃЊрЃЮрЃЏрЃўрЃА рЃњрЃљрЃЏрЃЮрЃАрЃгрЃЮрЃарЃћрЃЉрЃўрЃА рЃерЃћрЃАрЃљрЃФрЃџрЃћрЃЉрЃџрЃЮрЃЉрЃљ рЃњрЃћрЃЦрЃюрЃћрЃЉрЃљ,
		рЃЏрЃљрЃњрЃарЃљрЃЏ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃўрЃЏ рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў, рЃЌрЃБ рЃљрЃЏрЃљрЃА рЃЊрЃћрЃЊрЃџрЃљрЃўрЃюрЃљрЃЏрЃЊрЃћ рЃЏрЃЮрЃљрЃАрЃгрЃарЃћрЃЉ. рЃгрЃўрЃюрЃљ рЃЊрЃдрЃћрЃћрЃЉрЃўрЃА рЃњрЃљрЃЏрЃЮрЃфрЃЊрЃўрЃџрЃћрЃЉрЃўрЃЌ, 
		рЃБрЃЏрЃћрЃбрЃћрЃАрЃЮрЃЉрЃљ рЃўрЃюрЃАрЃбрЃарЃБрЃЦрЃфрЃўрЃћрЃЉрЃерЃў рЃцрЃЮрЃарЃЏрЃљрЃбрЃўрЃА рЃЏрЃЮрЃЌрЃ«рЃЮрЃЋрЃюрЃљрЃА рЃљрЃа рЃЎрЃўрЃЌрЃ«рЃБрЃџрЃЮрЃЉрЃЌ рЃарЃўрЃА рЃњрЃљрЃЏрЃЮрЃф рЃАрЃљрЃГрЃўрЃарЃЮ рЃ«рЃЊрЃћрЃЉрЃљ
		рЃ«рЃЮрЃџрЃЏрЃћ рЃЮрЃарЃ»рЃћрЃа рЃЌрЃљрЃЋрЃўрЃЊрЃљрЃю рЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃљ. <strong>рЃљрЃЏрЃљрЃА рЃЋрЃћрЃа рЃерЃћрЃФрЃџрЃћрЃЉрЃЌ рЃЌрЃБ рЃЉрЃЮрЃџрЃЮ рЃгрЃБрЃЌрЃћрЃЉрЃерЃў 
		рЃЊрЃљрЃўрЃгрЃДрЃћрЃЉрЃЌ рЃцрЃљрЃўрЃџрЃћрЃЉрЃўрЃА рЃљрЃбрЃЋрЃўрЃарЃЌрЃЋрЃљрЃА.</strong> рЃћрЃарЃЌрЃљрЃЊрЃћрЃарЃЌрЃў, рЃарЃўрЃЌрЃўрЃф рЃерЃћрЃЏрЃўрЃФрЃџрЃўрЃљ рЃЊрЃљрЃњрЃћрЃ«рЃЏрЃљрЃарЃЮрЃЌ, рЃљрЃарЃўрЃА рЃарЃЮрЃЏ
		рЃърЃарЃЮрЃњрЃарЃљрЃЏрЃљ рЃБрЃцрЃарЃЮ рЃЏрЃћрЃбрЃў рЃАрЃўрЃ«рЃерЃўрЃарЃўрЃЌ рЃерЃћрЃљрЃАрЃгрЃЮрЃарЃћрЃЉрЃА рЃ«рЃЮрЃџрЃЏрЃћ рЃљрЃбрЃЋрЃўрЃарЃЌрЃБрЃџ рЃцрЃљрЃўрЃџрЃћрЃЉрЃА (10-15рЃгрЃЌ)</p> 
		
		<p>рЃърЃарЃЮрЃћрЃЦрЃбрЃўрЃА рЃцрЃљрЃўрЃџрЃћрЃЉрЃў рЃБрЃюрЃЊрЃљ рЃљрЃбрЃЋрЃўрЃарЃЌрЃЮрЃА рЃњрЃБрЃюрЃЊрЃўрЃА <strong>рЃДрЃЋрЃћрЃџрЃљ</strong> рЃгрЃћрЃЋрЃарЃЏрЃљ</p>

		<p>рЃЎрЃџрЃљрЃАрЃарЃБрЃЏрЃќрЃћ рЃЏрЃўрЃЌрЃўрЃЌрЃћрЃЉрЃБрЃџрЃў рЃЌрЃљрЃарЃўрЃдрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ рЃърЃарЃЮрЃћрЃЦрЃбрЃўрЃА рЃцрЃљрЃўрЃџрЃћрЃЉрЃў/рЃерЃћрЃАрЃгрЃЮрЃарЃћрЃЉрЃћрЃЉрЃў рЃљрЃа рЃЏрЃўрЃўрЃдрЃћрЃЉрЃљ/рЃЏрЃЮрЃгрЃЏрЃЊрЃћрЃЉрЃљ.</p>
	`
}

main()