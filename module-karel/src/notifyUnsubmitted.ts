import { mergeResults, Partitions } from './partitions'

// рЃћрЃА notifications.ts-рЃерЃўрЃф рЃгрЃћрЃарЃўрЃљ
// рЃЊрЃљ рЃЎрЃљрЃарЃњрЃў рЃљрЃЏрЃЉрЃљрЃЋрЃў рЃўрЃАрЃљрЃљ рЃарЃЮрЃЏ рЃЮрЃарЃ»рЃћрЃа рЃњрЃљрЃЏрЃЮрЃФрЃљрЃ«рЃћрЃЉрЃљ рЃљрЃарЃљрЃљ рЃърЃарЃЮрЃЉрЃџрЃћрЃЏрЃљ...
import { getArgs } from './cli'
import fs from 'fs'
// import { getStudents, UserProfile } from 'classroom-api'
import { notify } from './notifications'
import { summaries, S } from './templates'

function main() {
	const { hw, runOpts } = getArgs()
	const results: S[] = mergeResults(hw, runOpts)
	const partitioned:any = {}
    // ­Ъўб­Ъўб­Ъўб­Ъўб рЃћрЃА рЃЏрЃЌрЃџрЃўрЃљрЃюрЃў рЃърЃарЃЮрЃфрЃћрЃАрЃў
    // рЃарЃљрЃЏ рЃЏрЃЮрЃЏрЃљрЃцрЃўрЃЦрЃарЃћрЃЉрЃўрЃюрЃљ partitions, рЃДрЃЮрЃцрЃўрЃџрЃўрЃДрЃЮ submission-рЃўрЃА 
    // рЃЋрЃћрЃџрЃў рЃЌрЃљрЃЋрЃўрЃЊрЃљрЃюрЃЋрЃћ
    results.forEach(r => {
    	if (r.status) {
    		if (partitioned[r.status]) {
    			partitioned[r.status].push(r)
    		} else {
    			partitioned[r.status] = [r]
    		}
    	}
    })

    notify(
    	partitioned,
    	categoriesToNotify,
    	subject,
    	hw,
    	runOpts,
    	{}
    	)
}

function subject(hwName: string) {
	return `рЃЏрЃюрЃўрЃерЃЋрЃюрЃћрЃџрЃЮрЃЋрЃљрЃюрЃў! рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃљ ${hwName} рЃљрЃа рЃљрЃарЃўрЃА рЃЕрЃљрЃЉрЃљрЃарЃћрЃЉрЃБрЃџрЃў`
}

const categoriesToNotify: Partitions<boolean> | any = {
        crashed: false,
        notSubmitted: true,
        late: false,
        invalid: true,
        error: false,
        failed: false,
        passed: false,
        none: false
}



const templates = {
	invalid: (s: S) => `
		${summaries.greeting(s)}

		рЃћрЃА рЃљрЃарЃўрЃА рЃљрЃЋрЃбрЃЮрЃЏрЃљрЃбрЃБрЃарЃљрЃЊ рЃњрЃљрЃЏрЃЮрЃњрЃќрЃљрЃЋрЃюрЃўрЃџрЃў рЃерЃћрЃбрЃДрЃЮрЃЉрЃўрЃюрЃћрЃЉрЃљ рЃўрЃЏрЃўрЃА рЃерЃћрЃАрЃљрЃ«рЃАрЃћрЃюрЃћрЃЉрЃџрЃљрЃЊ, рЃарЃЮрЃЏ рЃЉрЃЮрЃџрЃЮрЃА рЃљрЃбрЃЋрЃўрЃарЃЌрЃБрЃџрЃў
		рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃљ рЃљрЃарЃљрЃАрЃгрЃЮрЃа рЃцрЃЮрЃарЃЏрЃљрЃбрЃерЃўрЃљ, рЃарЃўрЃА рЃњрЃљрЃЏрЃЮрЃф рЃљрЃа рЃерЃћрЃЏрЃЮрЃгрЃЏрЃћрЃЉрЃБрЃџрЃљ рЃЊрЃљ рЃљрЃа рЃўрЃЌрЃЋрЃџрЃћрЃЉрЃљ рЃЕрЃљрЃЉрЃљрЃарЃћрЃЉрЃБрЃџрЃљрЃЊ. рЃЌрЃБ рЃЊрЃћрЃЊрЃџрЃљрЃўрЃюрЃљрЃЏрЃЊрЃћ
		рЃАрЃгрЃЮрЃа рЃцрЃЮрЃарЃЏрЃљрЃбрЃерЃў рЃљрЃа рЃљрЃбрЃЋрЃўрЃарЃЌрЃљрЃЋ (1 рЃгрЃБрЃЌрЃќрЃћ рЃюрЃљрЃЎрЃџрЃћрЃЉрЃўрЃљ рЃАрЃљрЃГрЃўрЃарЃЮ), рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃљ рЃљрЃа рЃЕрЃљрЃўрЃЌрЃЋрЃџрЃћрЃЉрЃљ.

		рЃДрЃЮрЃЋрЃћрЃџрЃў рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃўрЃАрЃЌрЃЋрЃўрЃА рЃЦрЃЋрЃћрЃЏрЃЮрЃЌ рЃЕрЃљрЃЋрЃАрЃЋрЃљрЃЏ рЃгрЃўрЃюрЃљ рЃЏрЃћрЃўрЃџрЃўрЃА рЃбрЃћрЃЦрЃАрЃбрЃА
		рЃўрЃљ
		
		${summaries.invalid(s)}
	`,
	notSubmitted: (s: S) => `
		${summaries.greeting(s)}

		рЃЊрЃћрЃЊрЃџрЃљрЃўрЃюрЃљрЃЏрЃЊрЃћ 1 рЃЊрЃдрЃћ рЃарЃЕрЃћрЃЉрЃљ рЃЊрЃљ рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃљ рЃљрЃа рЃњрЃљрЃЦрЃЋрЃА рЃњрЃљрЃЏрЃЮрЃњрЃќрЃљрЃЋрЃюрЃўрЃџрЃў.

		рЃерЃћрЃњрЃљрЃ«рЃАрЃћрЃюрЃћрЃЉ, рЃарЃЮрЃЏ рЃюрЃћрЃЉрЃўрЃАрЃЏрЃўрЃћрЃарЃў рЃерЃћрЃфрЃЊрЃЮрЃЏрЃўрЃА рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў рЃњрЃљрЃЏрЃЮрЃАрЃгрЃЮрЃарЃћрЃЉрЃўрЃА рЃерЃћрЃАрЃљрЃФрЃџрЃћрЃЉрЃџрЃЮрЃЉрЃљ рЃњрЃћрЃЦрЃюрЃћрЃЉрЃљ,
		рЃЏрЃљрЃњрЃарЃљрЃЏ рЃЏрЃ«рЃЮрЃџрЃЮрЃЊ рЃўрЃЏ рЃерЃћрЃЏрЃЌрЃ«рЃЋрЃћрЃЋрЃљрЃерЃў, рЃЌрЃБ рЃљрЃЏрЃљрЃА рЃЊрЃћрЃЊрЃџрЃљрЃўрЃюрЃљрЃЏрЃЊрЃћ рЃЏрЃЮрЃљрЃАрЃгрЃарЃћрЃЉ.

		рЃЎрЃџрЃљрЃАрЃарЃБрЃЏрЃќрЃћ рЃЏрЃўрЃЌрЃўрЃЌрЃћрЃЉрЃБрЃџрЃў рЃЌрЃљрЃарЃўрЃдрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ рЃЊрЃљрЃЋрЃљрЃџрЃћрЃЉрЃћрЃЉрЃў/рЃерЃћрЃАрЃгрЃЮрЃарЃћрЃЉрЃћрЃЉрЃў рЃљрЃа рЃЏрЃўрЃўрЃдрЃћрЃЉрЃљ/рЃЏрЃЮрЃгрЃЏрЃЊрЃћрЃЉрЃљ

		рЃўрЃљ
	`
}

main()